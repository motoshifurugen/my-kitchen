> **⚠️ このファイルはアーカイブされました**
>
> このファイルの内容は `docs/ux/phase-1/04-lighting.md` に統合されました。
> 最新の情報はそちらを参照してください。
>
> ---

# 06: ライティング仕様
_Lighting & Tone Specification_

---

## 概要

時間帯・季節に応じたライティング変化の仕様を定義する。
モード切替ではなく、世界に時間が流れていることを感じさせる仕組み。

**対象プラットフォーム:** iOS / Android（React Native）

**関連イシュー:** UX-041, UX-042, UX-048, UX-049

**準拠ドキュメント:**
- `01-screen-flows.md` — 画面遷移・世界表示ルール
- `04-motion-tokens.md` — 補間タイミング・デュレーション
- `05-2_5d-asset-spec.md` — レイヤースタック・合成方式（正）

---

## 権威あるメカニズム（Authoritative Mechanism）

### 世界ライティングの制御方法

ライティング変化は以下の2つのアセットとランタイムパラメータで**のみ**制御される：

| 要素 | 制御方式 | ランタイムパラメータ |
|------|---------|-------------------|
| 時間帯トーン | Time Overlay アセット（6枚） | `overlayId` + `opacity` (0.0-1.0) |
| 季節トーン | Season Overlay アセット（4枚） | `overlayId` + `opacity` (0.0-1.0) |

**合成方式:** Normal + opacity（05-2_5d-asset-spec.md §実装互換性 に準拠）

### 数値ターゲットの位置づけ

本ドキュメントに記載の Kelvin / L* / 彩度 は**アート制作の意図指標**であり、ランタイムで参照されない。
実装上は overlay アセットの `opacity` 値のみが制御対象となる。

---

## 基本原則（World Bible準拠）

### ライティングは「設定」ではない

- ダークモード/ライトモードの切替は**禁止**
- ボタンでのテーマ変更は**禁止**
- ライティングは「自然現象」として扱う

### 感情リアリティ優先

- 物理的な色温度の正確さより「印象」を優先
- 「朝っぽい」「夜っぽい」と感じられればよい
- 現実再現ではなく、感情演出

---

## 時間帯トーン（6区分）

### 数値ターゲット（アート意図のみ）

| 区分 | 時刻 | 色温度(K相当) | 明度(L*) | 彩度 | 影 |
|------|------|--------------|---------|------|-----|
| 早朝 | 4:00-6:00 | 5500-6000K | 35-50 | 低 | ほぼなし |
| 朝 | 6:00-10:00 | 5500-6500K | 70-85 | 低〜中 | 柔らか |
| 昼 | 10:00-16:00 | 5500-6000K | 90-100 | 自然 | 短め |
| 夕方 | 16:00-19:00 | 4000-5000K | 60-75 | やや高 | 長め |
| 夜 | 19:00-23:00 | 2700-3500K | 40-55 | 低〜中 | ソフト |
| 深夜 | 23:00-4:00 | 2200-2700K | 20-35 | 低 | 穏やか |

**注:** これらの値はアート制作時の参照指標。ランタイムでは使用しない。

### 各時間帯の印象

#### 早朝（4:00-6:00）
- **印象**: 目覚め前、静寂、まだ暗い空気
- **光の質**: 拡散、淡い、影ほぼなし
- **アセット**: `time-overlay-dawn@2x.png`

#### 朝（6:00-10:00）
- **印象**: 始まり、軽さ、澄んだ空気
- **光の質**: 自然光、クリア、柔らかい影
- **アセット**: `time-overlay-morning@2x.png`

#### 昼（10:00-16:00）
- **印象**: 活動的、フラット、自然体
- **光の質**: 均一、影短め、コントラスト低
- **アセット**: `time-overlay-noon@2x.png`

#### 夕方（16:00-19:00）
- **印象**: 少し温かい、帰宅、余韻の始まり
- **光の質**: 斜め光、長い影、やわらかいコントラスト
- **アセット**: `time-overlay-evening@2x.png`

#### 夜（19:00-23:00）
- **印象**: 落ち着き、安心、包まれる感覚
- **光の質**: ランプ光、拡散、ソフトシャドウ
- **アセット**: `time-overlay-night@2x.png`

#### 深夜（23:00-4:00）
- **印象**: 静寂、余白、ほぼ眠り
- **光の質**: 最小光量、コントラスト低、穏やか
- **アセット**: `time-overlay-midnight@2x.png`

---

## 季節トーン（4季節）

### 月別定義

| 季節 | 期間 | グラデーション開始 | 備考 |
|------|------|-------------------|------|
| 春 | 3月1日〜5月31日 | 2月15日から開始 | |
| 夏 | 6月1日〜8月31日 | 5月15日から開始 | |
| 秋 | 9月1日〜11月30日 | 8月15日から開始 | |
| 冬 | 12月1日〜2月末日 | 11月15日から開始 | 閏年は2月29日まで含む |

### 各季節の方向性

| 季節 | 色味 | 彩度 | 印象 | アセット |
|------|------|------|------|---------|
| 春 | やや明るく、淡いピンク〜緑 | やや高め | 芽吹き、柔らかい光 | `season-overlay-spring@2x.png` |
| 夏 | クリア、やや涼しげな青緑 | 自然 | 爽やか、日差し | `season-overlay-summer@2x.png` |
| 秋 | 暖色寄り、オレンジ〜茶 | やや低め | 穏やか、収穫 | `season-overlay-autumn@2x.png` |
| 冬 | やや青み、落ち着いたグレー | 低め | 静けさ、温もりとの対比 | `season-overlay-winter@2x.png` |

---

## 合成ルール

### レイヤー順序（05-2_5d-asset-spec.md 準拠）

```
Layer 5: Season Overlay  ← opacity 0.0-0.15
Layer 4: Time Overlay    ← opacity 0.0-1.0
Layer 3: Household Props
Layer 2: Age Props
Layer 1: Base Kitchen
```

### 合成方式

**Primary:** Normal + opacity（全プラットフォーム共通）

| レイヤー | 合成モード | opacity 範囲 | 備考 |
|---------|-----------|-------------|------|
| Time Overlay | Normal | 0.0 - 1.0 | 効果はアセットに焼き込み済み |
| Season Overlay | Normal | 0.0 - 0.15 | 控えめに適用（muddy 防止） |

**注:** Soft Light / Overlay / Multiply 効果はアセット制作時に焼き込む。ランタイムでは Normal + opacity のみ使用。

### opacity 上限ガイドライン

| 組み合わせ | Time opacity | Season opacity | 合計印象 |
|-----------|-------------|----------------|---------|
| 昼 × 任意季節 | 0.3-0.5 | 0.05-0.10 | 明るくフラット |
| 夜 × 冬 | 0.7-0.9 | 0.10-0.15 | 落ち着いた青み |
| 夕方 × 秋 | 0.6-0.8 | 0.10-0.15 | 暖色の余韻 |

**muddy 防止ルール:** `Time opacity + Season opacity ≤ 1.0` を維持。Season は常に控えめに。

---

## ランタイムルール（Runtime Rules）

### 評価タイミング

| トリガー | 評価対象 | 処理 |
|---------|---------|------|
| アプリ起動 | Time + Season | 現在時刻/日付で overlay 選択、opacity 設定 |
| フォアグラウンド復帰 | Time + Season | 経過時間に応じて再評価 |
| 15分タイマー | Time | 次セグメントへのクロスフェード判定 |
| 日付変更（0:00） | Season | 季節遷移進行度を更新 |
| タイムゾーン変更 | Time | 即時再評価 |

### 時間帯クロスフェード仕様

セグメント境界での急激な変化を防ぐため、2枚の Time Overlay をクロスフェードする。

```
方式: 2枚クロスフェード
- 現在セグメント overlay: opacity 1.0 → 0.0
- 次セグメント overlay: opacity 0.0 → 1.0
- デュレーション: 300ms (duration.transition.overlay 参照)
- イージング: easeOut (easing.easeOut 参照)
- 評価間隔: 15分ごと
```

**境界付近の振る舞い:**
- セグメント終了10分前から次セグメント overlay をプリロード
- 境界到達時にクロスフェード実行
- 境界直後にキャッシュ解放（前セグメント）

### 季節クロスフェード仕様

```
遷移期間: 約2週間（14日）
方式: 日次で opacity を線形補間
- 遷移開始日: 季節変わりの15日前
- 遷移完了日: 季節開始日
- 1日あたり変化: opacity ≈ 0.07
```

### キャッシュ戦略

| アセット | ロードタイミング | 保持期間 |
|---------|----------------|---------|
| 現在 Time Overlay | 起動時 | 常駐 |
| 次 Time Overlay | 境界10分前 | クロスフェード完了まで |
| 現在 Season Overlay | 起動時 | 常駐 |
| 次 Season Overlay | 遷移開始日 | 遷移完了まで |

---

## UI 隔離ルール（UI Isolation Rules）

### 原則

**世界レイヤーのライティング変化は UI に影響しない。**

これはアクセシビリティと可読性を常に担保するためである。

### 影響範囲

| カテゴリ | ライティング影響 | 理由 |
|---------|-----------------|------|
| Base Kitchen | ✅ 受ける | 世界の一部 |
| Props（Age/Household） | ✅ 受ける | 世界の一部 |
| Ambient Loops | ✅ 受ける | 世界の一部 |
| Time/Season Overlay | - | ライティングそのもの |
| テキスト色 | ❌ 受けない | 可読性確保 |
| UI アクセント色 | ❌ 受けない | 一貫性 |
| ボタン | ❌ 受けない | 操作性 |
| フッター | ❌ 受けない | ナビゲーション明確性 |
| モーダル/オーバーレイ UI | ❌ 受けない | 操作性 |
| エラー/成功色 | ❌ 受けない | セマンティック維持 |

### 実装ガイド

- UI コンポーネントは世界レイヤーより上位に配置（elevation.footer, elevation.modal 参照）
- UI 背景色は `color.background.primary` を固定使用
- 世界の blur 処理（S-02〜S-06）は UI 下層でのみ適用

---

## 禁止事項

- モード切替 UI
- ダークモードスイッチ
- 劇的な色変化（段階的クロスフェード必須）
- 「今夜モードです」のような表示
- ユーザーによる手動切替
- UI コンポーネントへのライティング適用

---

## QA チェックリスト

### 視覚品質

- [ ] セグメント境界で急激なジャンプがないか（クロスフェード確認）
- [ ] 世界の変化が控えめで、注目を奪っていないか
- [ ] 深夜トーンでも暗すぎて見えなくなっていないか
- [ ] Time × Season 合成で色が濁っていないか（muddy チェック）

### UI 可読性

- [ ] 全時間帯でテキストが読みやすいか
- [ ] 全時間帯でボタンが識別できるか
- [ ] フッターが常に明確に見えるか
- [ ] エラー/成功メッセージが識別できるか

### パフォーマンス

- [ ] 15分タイマーでの更新が滑らかか
- [ ] フォアグラウンド復帰時にちらつきがないか
- [ ] 低スペック端末でクロスフェードが 300ms 以内に完了するか

### エッジケース

- [ ] 閏年2月29日が正しく冬として扱われるか
- [ ] タイムゾーン変更時に正しく再評価されるか
- [ ] 23:59 → 0:00 境界でセグメント + 日付が正しく更新されるか

---

## 更新履歴

| 日付 | 更新内容 |
|------|---------|
| 2026-02-01 | 初版作成 |
| 2026-02-01 | 実装準備強化: 権威メカニズム明確化、05準拠（Normal+opacity）、ランタイムルール追加、UI隔離ルール追加、opacity上限ガイドライン追加、QAチェックリスト追加、閏年対応明記 |

---

## Change Log（今回の主要変更）

- **権威メカニズム追加**: overlay + opacity がランタイム制御の唯一の方法であることを明記
- **数値ターゲットの位置づけ**: Kelvin/L*/彩度 を「アート意図のみ」と明確化
- **合成方式統一**: 05-2_5d-asset-spec.md 準拠で Normal + opacity に統一、Soft Light 等はアセット焼き込み
- **opacity 上限追加**: Season overlay は 0.15 以下、muddy 防止ルール追加
- **ランタイムルール追加**: 評価タイミング、クロスフェード仕様、キャッシュ戦略を明記
- **motion tokens 参照**: クロスフェードに `duration.transition.overlay` (300ms)、`easing.easeOut` を使用
- **UI 隔離ルール追加**: 影響範囲を表で明確化、アクセシビリティ理由を記載
- **閏年対応**: 冬の期間を「2月末日」とし閏年2月29日を明記
- **QA チェックリスト追加**: 視覚品質、UI可読性、パフォーマンス、エッジケースの4カテゴリ
- **旧カラー参照削除**: 各時間帯のカラーコードをアセット名に置換（実装上使用しないため）
