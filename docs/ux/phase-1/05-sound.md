# 05: サウンド仕様
_Sound Design Specification_

---

## 概要

環境音（アンビエント）と儀式音の設計方針を定義する。
音は操作フィードバックではなく、キッチンに「気配」を与えるための環境要素。

**対象プラットフォーム:** iOS / Android（React Native）

**関連イシュー:** UX-053, UX-055

**参照ドキュメント:**
- `01-screen-flows.md` — 画面構成・世界表示ルール
- `04-lighting.md` — ライティング仕様（時間帯定義）
- `../world-bible/sound-philosophy.md` — 音の哲学

---

## 基本方針（World Bible準拠）

### 音は前に出ない

- 意識しないが、無いと寂しい
- 気づかないが、安心する
- BGMのように主役にならない

### 生活音を基準にする

- 現実のキッチンで自然に聞こえる音のみ
- ファンタジー効果音・ゲーム音は禁止

### 沈黙を尊重する

- 常時ループ音は使用しない
- 「無音」も演出の一部
- 音が鳴る時間より、**鳴らない時間の方が長い**

---

## サウンドカテゴリ

### 1. 環境音（Ambient）

空間に溶け込む短いフラグメント。世界が生きていることを感じさせる。

| 音種 | 例 | 再生方式 | MVP対応 |
|------|-----|---------|---------|
| 空調音 | 冷蔵庫のモーター、換気扇 | ワンショット（3-8秒） | ✅ |
| 生活音 | 遠くの物音、外の気配 | ワンショット（2-5秒） | ✅ |
| 調理音 | 湯気立ち、煮込みの余韻 | ワンショット（3-6秒） | ✅（夕方/夜のみ） |

**注:** 「常時再生の空気音」は使用しない。存在感は稀に鳴る短いフラグメントで表現する。

#### MVP での調理音の扱い

MVPでは料理中の状態判定は行わない。調理音は以下のルールで再生：
- **時間帯限定**: 夕方（16:00-19:00）と夜（19:00-23:00）のみ
- **稀に再生**: 他の環境音と同様のスケジューリングルールに従う
- **記録完了時**: セレブレーション演出の一部として短い調理余韻音を含めてよい

### 2. 儀式音（Moment Sounds）

特定の体験を支える小さなワンショット音。

| イベント | 音の方向性 | 長さ | MVP対応 |
|---------|-----------|------|---------|
| 記録完了 | やわらかいワンショット + 軽い湯気/余韻 | 300-600ms | ✅ |
| 棚追加 | 紙がめくれる/置かれる音 | 200-400ms | Phase 2 |
| グレードアップ | 軽いベル/木のクリック | 300-500ms | Phase 2 |

### 3. 使用しない音

| カテゴリ | 理由 |
|---------|------|
| UIクリック音（タップ音） | 操作フィードバックは視覚のみ |
| 画面遷移音 | 世界の気配ではない |
| 通知音（ピコン、チーン） | 注意を引く設計を避ける |
| ループBGM | 主役になってしまう |
| ゲーム的効果音 | Reality:Fantasy バランス違反 |

---

## 音量ガイドライン

### マスタリング基準（アセット制作時）

| 項目 | ターゲット | 備考 |
|------|-----------|------|
| Integrated LUFS | -24 to -20 LUFS | 環境音はより低め (-26 to -24) |
| True Peak | -1.0 dBTP 以下 | クリッピング防止 |
| サンプルピーク | -3 dB 以下 | 再生時の余裕確保 |

**注:** 厳密なブロードキャスト規格ではなく、一貫性のある音量感を確保するための目安。

### ランタイム音量制御

アプリは以下の2つのパラメータで再生音量を制御する：

```
最終音量 = ベースボリューム × 時間帯係数 × ユーザー設定係数
```

| パラメータ | 範囲 | 説明 |
|-----------|------|------|
| ベースボリューム | 0.0 - 1.0 | カテゴリ別のデフォルト音量 |
| 時間帯係数 | 0.0 - 1.0 | 深夜は小さく、昼は大きく |
| ユーザー設定係数 | 0.0 or 1.0 | ON/OFF のみ（スライダーなし） |

### カテゴリ別ベースボリューム

| カテゴリ | ベースボリューム | 体感 |
|---------|-----------------|------|
| 環境音 | 0.15 - 0.25 | 意識しないと聞こえない |
| 儀式音 | 0.35 - 0.45 | 瞬間的に気づく程度 |

## 時間帯別サウンド変化ルール

### 6時間帯のサウンド方針（トーン指針）

| Time Slot | 方針 | キーワード |
|-----------|------|-----------|
| early_morning | 空気音中心。最もクリアで軽い | 透明・静けさ・呼吸 |
| morning | 朝の生活が始まる"気配"を少し足す | 明るい・軽い生活感 |
| day | 生活音がやや増加（ただし遠景） | 日中の粒・密度少し増 |
| evening | 全体音量を落とし、落ち着き寄り | 夕方の柔らかさ |
| night | さらに音量を下げ、低域寄り | 静けさ・暗さ・低域 |
| late_night | ほぼ無音（必要最低限のみ） | 無音に近い・安心 |

### 時間帯別音量係数（ミックス係数）

**基準：** 常時ループの体感 -30〜-24dB相当を 1.00 として扱う（実際のdBは実装側で調整）。

#### マスター係数（全体の音量）

| Time Slot | MASTER |
|-----------|--------|
| early_morning | 1.00 |
| morning | 1.00 |
| day | 1.05 |
| evening | 0.90 |
| night | 0.75 |
| late_night | 0.15 |

#### レイヤー別係数（カテゴリごと）

| Time Slot | A:常時ループ | B:時間帯差分 | C:ワンショット |
|-----------|-------------|-------------|---------------|
| early_morning | 1.00 | 0.60 | 1.00 |
| morning | 1.00 | 0.55 | 1.00 |
| day | 1.00 | 0.75 | 1.00 |
| evening | 0.90 | 0.65 | 0.90 |
| night | 0.75 | 0.55 | 0.80 |
| late_night | 0.15 | 0.00 | 0.35 |

### 時間帯別使用音種制限

#### 常時ループ（A系）の採用ルール

| Time Slot | amb_room_air | amb_fridge_hum | amb_vent_soft | amb_outside_far |
|-----------|-------------|---------------|--------------|----------------|
| early_morning | ✅ | ✅(弱) | △(極小) | △(極小) |
| morning | ✅ | ✅(弱) | △ | △ |
| day | ✅ | ✅ | △ | ✅(弱) |
| evening | ✅(弱) | ✅ | △(弱) | ✅(弱) |
| night | ✅(極弱) | ✅(極弱) | ✖︎ | △(極弱) |
| late_night | ✅(ほぼ0) | ✖︎ or ✅(ほぼ0) | ✖︎ | ✖︎ |

**ルール:**
- `amb_outside_far` は 昼〜夕方のみが基本（夜に外音があると落ち着かない場合があるため）
- `amb_vent_soft` は"空調っぽさ"が出やすいので、夜は原則オフ

#### 時間帯差分（B系）の採用ルール

- early_morning/morning/day/evening/night は該当Bを使用し、隣接時間帯とクロスフェード
- late_night は B系は使用しない（0）

### 深夜の「ほぼ無音」の定義

**late_night は、以下を満たす状態を「ほぼ無音」とする：**

1. **B系（時間帯差分ループ）は完全停止**（係数 0）
2. **A系（常時ループ）は MASTER=0.15 かつ A係数=0.15 の範囲**
   - 体感として「耳を澄ませばわかるか、わからないか」程度
3. **外音（`amb_outside_far`）・換気（`amb_vent_soft`）は使用しない**
4. **UIワンショット（C系）は、必要時のみ、かつ 通常の35%（C係数=0.35）まで**
   - 通知音にならないこと（眠りを妨げない）

### 補間（切替）ルール

- **時間帯境界では 最短でも 2秒、推奨 6〜12秒でクロスフェード**
- **更新頻度：最低15分間隔で係数を更新**
- **可能なら「現在時刻 → 次の時間帯までの残り割合」で連続補間**
- **体感要件：**
  - "変化に気づかない"レベル
  - 変化に気づく場合は、補間時間を延ばす or 係数差を縮める

### 時間帯別係数（旧定義、互換性のため保持）

| 時間帯 | 係数 | 備考 |
|--------|------|------|
| 早朝 | 0.7 | 静かに |
| 朝 | 0.9 | 軽くクリア |
| 昼 | 1.0 | 標準 |
| 夕方 | 0.9 | やや落ち着き |
| 夜 | 0.7 | 低め |
| 深夜 | 0.3 | ほぼ無音 |

---

## 再生スケジューリングルール

### 環境音（Ambient）

「常時再生」ではなく、**稀に短いフラグメントを再生**し、沈黙を主体とする。

| ルール | 値 | 説明 |
|--------|-----|------|
| 最小沈黙時間 | 60秒 | 音と音の間に必ず確保 |
| 最大沈黙時間 | 180秒 | これ以上空けてもよいが、目安 |
| クリップクールダウン | 300秒 | 同じ音は5分以上空ける |
| 同時再生上限 | 2音 | 重なっても2つまで |
| 1分間の再生確率 | 15-25% | 毎分ランダム判定 |

#### スケジューリング擬似コード

```
毎60秒ごとに判定:
  if (前回再生から60秒以上経過) AND (ランダム確率通過):
    候補 = 時間帯に適した音リスト
    候補 = 候補 - 最近300秒以内に再生した音
    if (候補が存在):
      再生(候補からランダム選択)
```

### 儀式音（Moment Sounds）

| ルール | 値 | 説明 |
|--------|-----|------|
| トリガー | イベント発生時のみ | 記録完了など |
| 環境音との重複 | 避ける | 儀式音優先、環境音は遅延 |
| 連続イベント | 前の音完了後に次を再生 | 重ねない |

---

## システム連携ルール

### サイレントモード/マナーモード

| 状態 | 動作 |
|------|------|
| サイレント/マナーモード ON | **全ての音を再生しない** |
| 音量0（ボリュームゼロ） | 再生しない（システム依存） |
| 通常モード | 本仕様に従い再生 |

### 他アプリとの共存

| シナリオ | 動作 |
|---------|------|
| 他アプリで音楽/Podcast 再生中 | **本アプリの音は再生しない**（ミックスしない） |
| 音楽アプリがバックグラウンド再生中 | 同上（中断させない） |

**実装方針:** オーディオセッションを「ambient / mixable」ではなく、他の再生検知時は再生をスキップする。

### 割り込み処理

| イベント | 動作 |
|---------|------|
| 着信/通話開始 | 即時停止、通話終了後は自動再開しない |
| アラーム/タイマー | 即時停止 |
| Siri/音声アシスタント | 即時停止 |
| ヘッドフォン抜き差し | 停止（再生中の場合） |
| アプリがバックグラウンドへ | 停止 |
| アプリがフォアグラウンドへ | スケジューラー再開（即時再生はしない） |

---

## 設定UI

### 項目

| 設定 | デフォルト | 説明 |
|------|----------|------|
| 環境音 | ON | 環境音全体のON/OFF |
| 儀式音 | ON | 記録完了音等のON/OFF |

### 実装ノート

- 音量スライダーは設けない（シンプルに ON/OFF のみ）
- 端末の音量設定に追従
- サイレントモード時は設定に関わらず全て無音

---

## アセット一覧

### A. 常時ループ（World Scene の"床"）

| ID | アセット名（仮） | 用途 | 再生タイミング | 形式 | 長さ | ルール |
|----|----------------|------|---------------|------|------|--------|
| A1 | `amb_room_air` | 室内の空気（遠くの生活音の粒） | S-01表示中ずっと | AAC(.m4a) or MP3 | 60–120s | ループ、境界が分からない編集 |
| A2 | `amb_fridge_hum` | 冷蔵庫のモーター（低域） | S-01表示中 | AAC/MP3 | 30–60s | 低音強すぎ禁止（耳疲れ回避） |
| A3 | `amb_vent_soft` | 換気扇/空調の"風の層" | S-01表示中（微小） | AAC/MP3 | 30–60s | 常に薄く、存在感は最小 |
| A4 | `amb_outside_far` | 外の遠音（車/人の気配の超遠景） | 時間帯で混ぜ量を変える | AAC/MP3 | 60–120s | 鋭い音（クラクション等）は除去 |

### B. 時間帯差分ループ（時間の"気配"）

| ID | アセット名（仮） | 用途 | 再生タイミング | 形式 | 長さ | ルール |
|----|----------------|------|---------------|------|------|--------|
| B1 | `tod_early_morning` | 早朝の静けさ（鳥/遠い気配を極小） | early_morning 区間で薄く | AAC/MP3 | 60–120s | "鳥のさえずり"強め禁止（自然すぎると台所から離れる） |
| B2 | `tod_day` | 昼の生活感（遠音を少しだけ増やす） | day 区間で薄く | AAC/MP3 | 60–120s | 作業を邪魔しない密度 |
| B3 | `tod_evening` | 夕方の落ち着き（外気配が少し増える） | evening 区間で薄く | AAC/MP3 | 60–120s | 情緒過多にしない |
| B4 | `tod_night` | 夜の静けさ（外気配を減らす） | night/late_night で薄く | AAC/MP3 | 60–120s | "不穏"にならない |

### C. ワンショット（操作の"儀式"・安心のフィードバック）

| ID | アセット名（仮） | 用途 | 再生タイミング | 形式 | 長さ | ルール |
|----|----------------|------|---------------|------|------|--------|
| C1 | `ui_soft_tap` | 主要ボタンタップの触感 | Primary決定時のみ（乱発しない） | AAC/MP3 | 0.05–0.15s | カチカチ禁止、布/木/紙の柔らかさ |
| C2 | `ui_modal_open` | モーダル表示 | S-03等のモーダル表示時 | AAC/MP3 | 0.1–0.25s | "演出"ではなく存在通知 |
| C3 | `ui_modal_close` | モーダル閉じ | 閉じる操作時 | AAC/MP3 | 0.1–0.25s | 開く音と対になる |
| C4 | `ritual_saved` | 記録完了（セレブレーション） | S-08表示開始と同時 | AAC/MP3 | 0.4–0.8s | ファンファーレ禁止、ささやかな達成感 |

**注:** 10-09の定義では「常時ループ」と記載されているが、本仕様では「常時再生」ではなく「稀に短いフラグメントを再生」する方式を採用。上記アセットは必要に応じてループ再生またはワンショット再生として使用する。

## 音源仕様

### フォーマット推奨

| タイプ | 推奨フォーマット | 代替 | 注意事項 |
|--------|-----------------|------|---------|
| 環境音（フラグメント） | AAC (.m4a) | - | MP3はギャップ発生の可能性あり |
| 儀式音（ワンショット） | AAC (.m4a) | WAV | WAVはサイズ大（必要時のみ） |
| ループ使用時 | AAC (.m4a) | - | ループポイント設定必須、ギャップレス確認 |

**MP3 使用時の注意:** MP3はエンコーダ由来のサイレンスが先頭/末尾に付加されることがあり、ループ再生でギャップが発生する。ループ素材には使用しない。

### サンプルレート・ビット深度

| 項目 | 値 |
|------|-----|
| サンプルレート | 44.1kHz |
| ビット深度（WAV） | 16bit |
| AACビットレート | 128-192 kbps |

### ファイル命名規則

```
{category}_{name}.m4a

例:
amb_room_air.m4a
tod_early_morning.m4a
ritual_saved.m4a
```

### 長さ・ループ仕様

- **ループ：60–120秒を基本**（短いと"繰り返し感"が出る）
- **ループ境界：**
  - クリック/段差が出ないように、無音 0.2–0.5秒やクロスで処理
  - 可能なら"ループ用に編集された素材"を採用
- **ループの切替（時間帯）：クロスフェード 2–6秒**（気づかない速度）

### 調達方針

優先順位：
1. **購入（商用利用OKの効果音ライブラリ）**：品質が安定、編集もしやすい
2. **自前録音**：冷蔵庫/換気扇/食器など、固有性を出せる
3. **生成AI**：方向性は良いが、ループ品質や権利/再現性の管理に注意（要：利用規約確認）

作業フロー：
1. 収集
2. ノイズ除去
3. ループ編集
4. 音量合わせ
5. 書き出し（m4a）

---

## 音量レンジとダイナミクス

### 前提（用語と基準）

#### dB相当について

本仕様の「dB相当」は、実装上の正確なdBFS測定ではなく、体感音量を揃えるための目安。
最終的には実機（スピーカー）で耳合わせし、微調整する。

#### 基準となる環境

- **iPhone/Android の 本体スピーカー**
- **端末音量：中（50%）**
- **周囲環境：静かな室内**
- **目標：集中していないと気づかない / 気づいても気にならない**

### サウンドタイプ定義

| Type | 例 | 役割 |
|------|-----|------|
| A: 環境音（Base Ambience） | 冷蔵庫、空気、遠景生活音 | 世界の「床」 |
| B: 動作音（Diegetic Actions） | 食器が触れる、軽い置く音、引き出し | "気配"のアクセント |
| C: 儀式音（Ritual UI） | 記録完了音、保存の気配 | 操作の完了を「静かに」伝える |

### 音量レンジ（dB相当）

#### 推奨レンジ（耳合わせの初期値）

| Type | 平均（RMS相当） | ピーク（瞬間） | 備考 |
|------|----------------|---------------|------|
| A: 環境音 | -40〜-30 dB | -30〜-24 dB | "気づかない"が基準。気づくなら下げる |
| B: 動作音 | -30〜-25 dB | -22〜-18 dB | 小〜中。単発で「そこにある」程度 |
| C: 儀式音 | -28〜-22 dB | -18〜-14 dB | 一瞬だけ少し上げる（0.2〜0.6秒） |

#### late_night（深夜）の例外

- **A（環境音）：さらに -10dB相当**（体感で半分以下）
- **B（動作音）：原則鳴らさない**（または極小）
- **C（儀式音）：通常の 35%**（先の時間帯ルールに準拠）

### マスターボリュームとの関係

#### マスターの意味

アプリ内「音の演出（ON/OFF）」は マスターとする（個別種別は持たない方針）。

- **ON：以下のミックスが適用される**
- **OFF：全サウンド停止**（例外なし）

#### マスター×タイプの合成

最終出力は以下の乗算で決める：

```
FinalGain = MasterGain * TimeSlotGain * TypeGain * ClipGain
```

- **MasterGain：** ユーザー設定（ON/OFFのみなら 1 or 0）
- **TimeSlotGain：** 時間帯係数（時間帯別サウンド変化ルール参照）
- **TypeGain：** Typeごとの固定係数（A/B/Cのバランス）
- **ClipGain：** 素材ごとの微調整（個体差を吸収）

**ポイント：** dBレンジを守るには「素材の録り/生成の段階で揃える」＋「ClipGainで微調整」する。

### 同時再生時のミックスルール（重要）

#### 同時再生の上限（チャンネル数）

- **A（環境音）：同時 最大2トラック**
  - 例：`room_air` + `fridge_hum`
- **B（動作音）：同時 最大1音**（連続トリガーは抑制）
- **C（儀式音）：同時 最大1音**（重ねない）

#### 優先順位（ダッキング）

**優先順位：C > B > A**

- **C再生中（0.2〜0.6秒）：**
  - **Aを -3〜-6 dB相当ダッキング**（ふっと下げる）
  - **Bは原則鳴らさない**（ぶつかるため）
- **B再生中（単発）：**
  - **Aを -1〜-3 dB相当軽くダッキング**（任意）
- **Aは常に床：前に出ない**

#### 連続トリガー抑制（せわしない防止）

- **B（動作音）は 1.2秒クールダウン**（連打で鳴らない）
- **C（儀式音）は 2.0秒クールダウン**
- **連続操作でも「音が増えない」設計にする**

### ダイナミクス（時間変化・ゆらぎの方針）

#### A（環境音）

- **ループは完全固定ではなく、微小な揺れを許容**
- **例：±1dB相当を 30〜90秒周期で緩やかに**
- **ただし"うねり"が目立つなら固定に戻す**

#### B（動作音）

- **1回の発音は短く（80〜250ms中心）**
- **連続時に"カタカタ"にならないよう、抑制を優先**

#### C（儀式音）

- **立ち上がり：速い**（認知できる）
- **余韻：短い**（浸食しない）
- **音色：金属的・電子的を避け、やわらかい素材感**（木/布/陶器/紙）

### 端末音量との連動方針

- **端末のメディア音量に従う**（iOS/Android標準）
- **アプリ内に スライダーは置かない**（設定疲れを増やさない）
- **無音でも成立する：音は「必須情報」を担わない**
- **音がOFFでもUXが欠損しない**（視覚・触覚で完結）

---

## アセットバジェット（MVP）

全体アセットバジェット（03-assets.md: 50MB）との整合性を保つ。

| カテゴリ | ファイル数目安 | サイズ目安 |
|---------|--------------|-----------|
| 常時ループ（A系） | 4個 | 2-3 MB |
| 時間帯差分ループ（B系） | 4個 | 2-3 MB |
| ワンショット（C系） | 4個 | 1-2 MB |
| **合計** | **12個** | **5-8 MB** |

**ガイドライン:**
- 1ファイルあたり 500KB-1MB 程度を目安
- 長いループより短いフラグメント複数を優先
- 必要に応じて圧縮品質を調整

---

## 禁止事項

| 禁止項目 | 理由 |
|---------|------|
| 常時ループBGM | 主役になる、沈黙を奪う |
| 常時再生の空気音/ホワイトノイズ | 同上 |
| 派手なサウンド演出 | 注意を引く |
| 音で注意を引く設計 | World Bible違反 |
| 「鳴らして楽しい」音 | ゲーム的になる |
| 通知音の連打 | 煩わしい |
| 他アプリ音楽の中断/ミックス | ユーザー体験を損なう |

---

## QAチェックリスト

- [ ] サイレントモードで音が鳴らないこと
- [ ] 他アプリで音楽再生中に本アプリの音が鳴らないこと
- [ ] 環境音が60秒以上の間隔を空けて再生されること
- [ ] 同じ環境音が5分以内に連続しないこと
- [ ] 深夜帯（23:00-4:00）でほぼ無音に近いこと
- [ ] 儀式音が記録完了時に適切なタイミングで鳴ること
- [ ] 音量が主張しすぎず、意識しないと聞こえないレベルであること
- [ ] ヘッドフォン抜き差しで音が止まること

---

## 更新履歴

| 日付 | 更新内容 |
|------|---------|
| 2026-02-01 | 初版作成 |
| 2026-02-01 | 実装準備強化: LUFS/ボリューム制御追加、常時再生廃止・スケジューリングルール追加、MVP調理音方針決定、システム連携ルール追加、フォーマット推奨更新（AAC優先）、アセットバジェット追加、QAチェックリスト追加 |
